{"ast":null,"code":"import isSubset from '../../utils/isSubset';\nimport logger from \"../../utils/logger\";\nimport reset from '../../api-utils/reset';\nimport selectionLevel from '../../api-utils/selectionLevel';\nimport showUserErrors from '../../api-utils/showUserErrors';\nexport default function get() {\n  var _this = this;\n\n  var options = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {\n    keys: false\n  };\n\n  // get collection\n  this.getCollection = function () {\n    var collectionName = _this.collectionName;\n    var orderByProperty = _this.orderByProperty;\n    var orderByDirection = _this.orderByDirection;\n    var limitBy = _this.limitBy;\n    var collection = [];\n    return _this.lf[collectionName].iterate(function (value, key) {\n      var collectionItem = {};\n\n      if (!options.keys) {\n        collectionItem = value;\n      } else {\n        collectionItem = {\n          key: key,\n          data: value\n        };\n      }\n\n      collection.push(collectionItem);\n    }).then(function () {\n      var logMessage = \"Got \\\"\".concat(collectionName, \"\\\" collection\"); // orderBy\n\n      if (orderByProperty) {\n        logMessage += \", ordered by \\\"\".concat(orderByProperty, \"\\\"\");\n\n        if (!options.keys) {\n          collection.sort(function (a, b) {\n            return a[orderByProperty].toString().localeCompare(b[orderByProperty].toString());\n          });\n        } else {\n          collection.sort(function (a, b) {\n            return a.data[orderByProperty].toString().localeCompare(b.data[orderByProperty].toString());\n          });\n        }\n      }\n\n      if (orderByDirection == 'desc') {\n        logMessage += \" (descending)\";\n        collection.reverse();\n      } // limit\n\n\n      if (limitBy) {\n        logMessage += \", limited to \".concat(limitBy);\n        collection = collection.splice(0, limitBy);\n      }\n\n      logMessage += \":\";\n      logger.log.call(_this, logMessage, collection);\n      reset.call(_this);\n      return collection;\n    });\n  }; // get document\n\n\n  this.getDocument = function () {\n    var collectionName = _this.collectionName;\n    var docSelectionCriteria = _this.docSelectionCriteria;\n    var collection = [];\n    var document = {}; // get document by criteria\n\n    _this.getDocumentByCriteria = function () {\n      return _this.lf[collectionName].iterate(function (value, key) {\n        if (isSubset(value, docSelectionCriteria)) {\n          collection.push(value);\n        }\n      }).then(function () {\n        if (!collection.length) {\n          logger.error.call(_this, \"Could not find Document in \\\"\".concat(collectionName, \"\\\" collection with criteria: \").concat(JSON.stringify(docSelectionCriteria)));\n        } else {\n          document = collection[0];\n          logger.log.call(_this, \"Got Document with \".concat(JSON.stringify(docSelectionCriteria), \":\"), document);\n          reset.call(_this);\n          return document;\n        }\n      });\n    }; // get document by key\n\n\n    _this.getDocumentByKey = function () {\n      return _this.lf[collectionName].getItem(docSelectionCriteria).then(function (value) {\n        document = value;\n\n        if (document) {\n          logger.log.call(_this, \"Got Document with key \".concat(JSON.stringify(docSelectionCriteria), \":\"), document);\n        } else {\n          logger.error.call(_this, \"Could not find Document in \\\"\".concat(collectionName, \"\\\" collection with Key: \").concat(JSON.stringify(docSelectionCriteria)));\n        }\n\n        reset.call(_this);\n        return document;\n      }).catch(function (err) {\n        logger.error.call(_this, \"Could not find Document in \\\"\".concat(collectionName, \"\\\" collection with Key: \").concat(JSON.stringify(docSelectionCriteria)));\n        reset.call(_this);\n      });\n    };\n\n    if (typeof docSelectionCriteria == 'object') {\n      return _this.getDocumentByCriteria();\n    } else {\n      return _this.getDocumentByKey();\n    }\n  }; // check for user errors\n\n\n  if (!(typeof options == 'object' && options instanceof Array == false)) {\n    this.userErrors.push('Data passed to .get() must be an object. Not an array, string, number or boolean. The object must contain a \"keys\" property set to true or false, e.g. { keys: true }');\n  } else {\n    if (!options.hasOwnProperty('keys')) {\n      this.userErrors.push('Object passed to get() method must contain a \"keys\" property set to boolean true or false, e.g. { keys: true }');\n    } else {\n      if (typeof options.keys !== 'boolean') {\n        this.userErrors.push('Property \"keys\" passed into get() method must be assigned a boolean value (true or false). Not a string or integer.');\n      }\n    }\n  }\n\n  if (!this.userErrors.length) {\n    var currentSelectionLevel = selectionLevel.call(this);\n\n    if (currentSelectionLevel == 'collection') {\n      return this.getCollection();\n    } else if (currentSelectionLevel == 'doc') {\n      return this.getDocument();\n    }\n  } else {\n    showUserErrors.call(this);\n    return null;\n  }\n}","map":{"version":3,"sources":["C:/Users/zackj/Documents/GitHub/Manifest_Repo/node_modules/localbase/localbase/api/actions/get.js"],"names":["isSubset","logger","reset","selectionLevel","showUserErrors","get","options","keys","getCollection","collectionName","orderByProperty","orderByDirection","limitBy","collection","lf","iterate","value","key","collectionItem","data","push","then","logMessage","sort","a","b","toString","localeCompare","reverse","splice","log","call","getDocument","docSelectionCriteria","document","getDocumentByCriteria","length","error","JSON","stringify","getDocumentByKey","getItem","catch","err","Array","userErrors","hasOwnProperty","currentSelectionLevel"],"mappings":"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","sourcesContent":["import isSubset from '../../utils/isSubset'\r\nimport logger from \"../../utils/logger\"\r\nimport reset from '../../api-utils/reset'\r\nimport selectionLevel from '../../api-utils/selectionLevel'\r\nimport showUserErrors from '../../api-utils/showUserErrors'\r\n\r\nexport default function get(options = { keys: false }) {\r\n\r\n  // get collection\r\n  this.getCollection = () => {\r\n    let collectionName = this.collectionName\r\n    let orderByProperty = this.orderByProperty\r\n    let orderByDirection = this.orderByDirection\r\n    let limitBy = this.limitBy\r\n\r\n    let collection = []\r\n    return this.lf[collectionName].iterate((value, key) => {\r\n      let collectionItem = {}\r\n      if (!options.keys) {\r\n        collectionItem = value\r\n      }\r\n      else {\r\n        collectionItem = {\r\n          key: key,\r\n          data: value\r\n        }\r\n      }\r\n      collection.push(collectionItem)\r\n    }).then(() => {\r\n      let logMessage = `Got \"${ collectionName }\" collection`\r\n      // orderBy\r\n      if (orderByProperty) {\r\n        logMessage += `, ordered by \"${ orderByProperty }\"`\r\n        if (!options.keys) {\r\n          collection.sort((a, b) => {\r\n            return a[orderByProperty].toString().localeCompare(b[orderByProperty].toString())\r\n          })\r\n        }\r\n        else {\r\n          collection.sort((a, b) => {\r\n            return a.data[orderByProperty].toString().localeCompare(b.data[orderByProperty].toString())\r\n          })\r\n        }\r\n      }\r\n      if (orderByDirection == 'desc') {\r\n        logMessage += ` (descending)`\r\n        collection.reverse()\r\n      }\r\n      // limit\r\n      if (limitBy) {\r\n        logMessage += `, limited to ${ limitBy }`\r\n        collection = collection.splice(0,limitBy)\r\n      }\r\n      logMessage += `:`\r\n      logger.log.call(this, logMessage, collection)\r\n      reset.call(this)\r\n      return collection\r\n    })\r\n  }\r\n\r\n  // get document\r\n  this.getDocument = () => {\r\n    let collectionName = this.collectionName\r\n    let docSelectionCriteria = this.docSelectionCriteria\r\n\r\n    let collection = []\r\n    let document = {}\r\n\r\n    // get document by criteria\r\n    this.getDocumentByCriteria = () => {\r\n      return this.lf[collectionName].iterate((value, key) => {\r\n        if (isSubset(value, docSelectionCriteria)) {\r\n          collection.push(value)\r\n        }\r\n      }).then(() => {\r\n        if (!collection.length) {\r\n          logger.error.call(this, `Could not find Document in \"${ collectionName }\" collection with criteria: ${ JSON.stringify(docSelectionCriteria)}`)\r\n        }\r\n        else {\r\n          document = collection[0]\r\n          logger.log.call(this, `Got Document with ${ JSON.stringify(docSelectionCriteria) }:`, document)\r\n          reset.call(this)\r\n          return document\r\n        }\r\n      })\r\n    }\r\n\r\n    // get document by key\r\n    this.getDocumentByKey = () => {\r\n      return this.lf[collectionName].getItem(docSelectionCriteria).then((value) => {\r\n        document = value\r\n        if (document) {\r\n          logger.log.call(this, `Got Document with key ${ JSON.stringify(docSelectionCriteria) }:`, document)\r\n        }\r\n        else {\r\n          logger.error.call(this, `Could not find Document in \"${ collectionName }\" collection with Key: ${ JSON.stringify(docSelectionCriteria)}`)\r\n        }\r\n        reset.call(this)\r\n        return document\r\n      }).catch(err => {\r\n        logger.error.call(this, `Could not find Document in \"${ collectionName }\" collection with Key: ${ JSON.stringify(docSelectionCriteria)}`)\r\n        reset.call(this)\r\n      });\r\n    }\r\n\r\n    if (typeof docSelectionCriteria == 'object') {\r\n      return this.getDocumentByCriteria()\r\n    }\r\n    else {\r\n      return this.getDocumentByKey()\r\n    }\r\n  }\r\n\r\n  // check for user errors\r\n  if (!(typeof options == 'object' && options instanceof Array == false)) {\r\n    this.userErrors.push('Data passed to .get() must be an object. Not an array, string, number or boolean. The object must contain a \"keys\" property set to true or false, e.g. { keys: true }')\r\n  }\r\n  else {\r\n    if (!options.hasOwnProperty('keys')) {\r\n      this.userErrors.push('Object passed to get() method must contain a \"keys\" property set to boolean true or false, e.g. { keys: true }')\r\n    }\r\n    else {\r\n      if (typeof options.keys !== 'boolean') {\r\n        this.userErrors.push('Property \"keys\" passed into get() method must be assigned a boolean value (true or false). Not a string or integer.')\r\n      }\r\n    }\r\n  }\r\n\r\n  if (!this.userErrors.length) {\r\n    let currentSelectionLevel = selectionLevel.call(this)\r\n\r\n    if (currentSelectionLevel == 'collection') {\r\n      return this.getCollection()\r\n    }\r\n    else if (currentSelectionLevel == 'doc') {\r\n      return this.getDocument()\r\n    }\r\n  }\r\n  else {\r\n    showUserErrors.call(this)\r\n    return null\r\n  }\r\n\r\n}"]},"metadata":{},"sourceType":"module"}